<?php
/**
 * Created by Malik Abiola.
 * Date: 15/02/2016
 * Time: 18:14
 * IDE: PhpStorm.
 */
namespace MAbiola\Paystack\Tests;

use MAbiola\Paystack\Factories\PaystackHttpClientFactory;
use MAbiola\Paystack\Models\ReturningTransaction;
use MAbiola\Paystack\Repositories\TransactionResource;

class ReturningTransactionTest extends BaseTestCase
{
    public function setUp()
    {
        parent::setUp(); // TODO: Change the autogenerated stub
        $this->transactionResource = new TransactionResource(PaystackHttpClientFactory::make());
    }

    public function testChargeReturningTransaction()
    {
        $mockTransactionResource = \Mockery::mock($this->transactionResource)->makePartial();
        $mockTransactionResource->shouldReceive('chargeAuthorization')
            ->once()
            ->andReturn($this->chargeReturningTransactionResourceResponseData);

        $returningTransaction = ReturningTransaction::make('AUTH_jonwwppn', $this->planData['amount'], $this->customerData['email'], '');
        $returningTransaction->setTransactionResource($mockTransactionResource);
        $chargeReturningTransaction = $returningTransaction->charge();

        $this->assertEquals($this->chargeReturningTransactionResourceResponseData, $chargeReturningTransaction);
    }

    public function tearDown()
    {
        parent::tearDown(); // TODO: Change the autogenerated stub
    }
}
